from django.db import models
from django.contrib.auth import get_user_model
import uuid
from datetime import datetime
from django.db import models
from django.contrib.auth.models import User
import random



User = get_user_model()


class Profile(models.Model):
    # 当前操作的用户
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    id_user = models.IntegerField()
    # 个人介绍
    bio = models.TextField(blank=True)
    # 头像
    profileimg = models.ImageField(upload_to='profile_images', default='blank-profile-picture.png')
    # 地域
    location = models.CharField(max_length=100, blank=True)


# 博文，帖子
class Post(models.Model):
    id = models.UUIDField(primary_key=True, default=uuid.uuid4)
    # 用户名
    user = models.CharField(max_length=100)
    # 发的帖子图片
    image = models.ImageField(upload_to='post_images')
    # 标题
    caption = models.TextField()
    created_at = models.DateTimeField(default=datetime.now)
    # 点赞数
    no_of_likes = models.IntegerField(default=0)


class LikePost(models.Model):
    # 文章id
    post_id = models.CharField(max_length=500)
    # 用户名
    username = models.CharField(max_length=100)


class FollowersCount(models.Model):
    # 跟随者
    follower = models.CharField(max_length=100)
    # 用户
    user = models.CharField(max_length=100)

class 用户信息(models.Model):
    # 当前操作的用户
    用户名 = models.ForeignKey(User, on_delete=models.CASCADE)
    id_user = models.IntegerField()
    # 个人介绍
    个性签名 = models.TextField(blank=True)
    # 头像
    头像 = models.ImageField(upload_to='profile_images', default='blank-profile-picture.png')
    # 地域
    背景图片 = models.ImageField(upload_to='profile_images', default='blank-profile-picture.png')



class 游戏帖子(models.Model):
    发帖人 = models.ForeignKey(User, on_delete=models.CASCADE, verbose_name="发帖人")
    链接 = models.URLField(verbose_name="链接")
    标题 = models.CharField(max_length=200, verbose_name="标题")
    内容 = models.TextField(verbose_name="内容")
    日期 = models.DateField(auto_now_add=True, verbose_name="日期")
    封面 = models.ImageField(upload_to="game_images/", blank=True, null=True, verbose_name="游戏图片")



class 游戏帖子图片(models.Model):
    游戏帖子 = models.ForeignKey(游戏帖子, on_delete=models.CASCADE, related_name='游戏图片', verbose_name="游戏帖子")
    图片 = models.FileField(upload_to="game_images/", verbose_name="游戏图片")


class 评论(models.Model):
    帖子 = models.ForeignKey(游戏帖子, on_delete=models.CASCADE, related_name='评论', verbose_name="游戏帖子")
    发评时间 = models.DateTimeField(auto_now=True)
    评论人 = models.ForeignKey(User, on_delete=models.CASCADE, verbose_name="评论人")
    点赞数 = models.PositiveIntegerField(default=0, verbose_name="点赞数")
    评论 = models.TextField(verbose_name="评论")



class AIModel(models.Model):
    # AI的ID
    aiid = models.AutoField(primary_key=True)
    # 所属用户
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    # 性格文件
    personality_text = models.TextField(max_length=5000)
    # 聊天记录
    聊天记录 = models.TextField(max_length=100000000)
    # 聊天记录（向量库字典）
    chat_vector_dict =  models.TextField(default='{"[-1.68153062e-03,  2.43797675e-02, -1.32503547e-02, -2.05103625e-02, -3.26450132e-02, -8.00530165e-02,  2.01870799e-02,  1.10741390e-03, -3.96414995e-02,  8.37434921e-03,  6.24340177e-02, -2.80282972e-03,  8.97468068e-03, -4.98113856e-02, -6.12936020e-02,  1.18295951e-02, -3.23835964e-04, -2.79534129e-06, -1.16257342e-02,  3.37453261e-02,  4.16543409e-02, -3.88930514e-02,  2.56704483e-02,  1.57536170e-03, -2.75832284e-02, -1.55332461e-02,  9.82851442e-03, -1.72754545e-02,  4.37555723e-02,  2.66544111e-02, -2.16098670e-02,  8.32269937e-02, -1.62739232e-02, -2.23733522e-02,  1.85968801e-02,  9.53080691e-03, -4.21587471e-03, -1.17035415e-02, -1.42236892e-02,  4.66979854e-02, -2.52543506e-03,  4.24870383e-03,  2.47841813e-02,  5.90879470e-02,  8.45521130e-03,  2.87443828e-02,  2.07039677e-02, -1.96452215e-02,  4.99868691e-02,  2.98010055e-02,  2.94750277e-02,  3.64621282e-01, -3.73730040e-03, -7.64437346e-03, -6.18494302e-03,  2.66594235e-02, -2.74014361e-02, -1.04774078e-02, -1.12338681e-02, -3.13029289e-02, -3.00030746e-02, -1.62108522e-02,  5.93544692e-02, -3.41742449e-02, -1.28478296e-02, -3.90422787e-03, -5.08406945e-03, -2.70944554e-02,  1.27247535e-02, -5.28634116e-02, -2.45172884e-02, -2.48462409e-02, -2.31722817e-02,  4.14998308e-02,  2.14459766e-02, -2.99673676e-02, -4.16465988e-03, -1.70491356e-02, -1.61621310e-02, -1.56134414e-02, -1.06103187e-02,  4.35847640e-02, -1.82881136e-03,  3.35813686e-02, -3.02652139e-02,  1.03716590e-02, -2.39971876e-02, -3.01987324e-02,  2.10539754e-02,  2.60732416e-02, -5.59925521e-03,  3.99192348e-02,  1.31231816e-02,  1.18318392e-04,  8.26849416e-02, -1.66426599e-02, -2.88185310e-02,  4.86722216e-02,  4.58903201e-02, -9.87522583e-03, -1.59669928e-02, -3.89025472e-02, -2.92796381e-02, -2.19513196e-02,  2.24762447e-02,  2.09729210e-03,  2.04365235e-02,  2.88733188e-02, -9.70514677e-03, -5.55018371e-04,  2.94654659e-04,  1.27536366e-02,  2.98769381e-02,  5.18740453e-02, -3.82340234e-03, -1.18397633e-02,  4.00085710e-02, -1.92654529e-03, -3.07043158e-02, -8.95986147e-03, -2.43759397e-02, -1.35505181e-02,  8.04160535e-03, -1.30149433e-02, -1.17818909e-02, -1.05702262e-02,  1.93882571e-03,  3.25293094e-02, -1.27833430e-02, -2.63926890e-02, -3.95760350e-02,  1.24777462e-02, -2.97746081e-02,  6.65348629e-03,  6.49663759e-03,  6.82884082e-02,  1.21102845e-02, -1.43573023e-02,  2.48975474e-02, -2.36610491e-02,  1.28122553e-01, -5.00582205e-03, -5.14216311e-02, -1.63911972e-02,  3.02461977e-03, -5.50614633e-02,  3.15540321e-02,  5.89381089e-04, -3.12672108e-02,  2.94167027e-02,  7.54353702e-02,  1.26734255e-02,  8.75364617e-03, -1.80248003e-02,  1.54847943e-03, -3.66182555e-03,  1.22753829e-02, -2.08675163e-03, -5.86701138e-03, -1.67585444e-02,  1.39101455e-02,  2.66233762e-03, -1.28219342e-02, -1.45540303e-02,  2.28253417e-02,  5.67827001e-03,  1.19494218e-02, -1.73798203e-02, -5.20401187e-02,  1.90032516e-02, -3.11137233e-02,  1.72467821e-03, -8.99697375e-03,  3.86855304e-02,  2.06237193e-02, -8.50676093e-03,  1.08302377e-01, -4.02728878e-02, -7.16172010e-02, -1.97184067e-02,  8.59613251e-03, -2.47619282e-02,  2.80409921e-02,  7.02011138e-02,  3.61296870e-02, -1.10266274e-02,  6.38398295e-03, -3.16419490e-02,  1.25429379e-02,  2.35615186e-02, -8.61607417e-02,  1.35385655e-02,  2.35238243e-02, -9.86650866e-03,  6.22001709e-03, -1.50375918e-03, -5.36832251e-02, -7.00569898e-02, -6.60505146e-02, -2.95074482e-04, -1.24550248e-02,  2.41621472e-02, -2.03314051e-03, -7.93670490e-03, -3.45532928e-04, -1.83161534e-02,  3.23542431e-02,  2.14110520e-02, -9.68590938e-03,  1.00508574e-02,  1.01732314e-01, -4.64500561e-02, -1.23959184e-02,  1.04384020e-01,  1.03347013e-02, -2.50453483e-02, -2.48999856e-02, -5.16586676e-02, -5.37274824e-03,  1.41750835e-02,  2.42228862e-02, -3.86662483e-02, -3.46014276e-02, -2.84273736e-02, -3.31974439e-02,  3.36821470e-03, -2.40119901e-02, -5.23791695e-03,  4.35489677e-02, -7.16655329e-03, -2.70462018e-02,  1.46214403e-02, -2.84445174e-02, -1.54933892e-02,  7.96536333e-04,  6.06225058e-02, -7.80106187e-02,  1.81494281e-02,  1.71334613e-02, -3.96458479e-03, -1.16753951e-02,  3.69060348e-04, -2.06762291e-02, -3.62564325e-02, -3.68547328e-02, -9.07128397e-03,  1.24366116e-02, -1.14331127e-03,  3.41772027e-02, -5.73875010e-02,  1.83448456e-02, -2.70056352e-02, -1.34606622e-02, -4.97996323e-02,  9.43420362e-03, -1.54186063e-03, -1.63093489e-02,  3.46870720e-02,  1.54126175e-02,  3.08448896e-02, -1.37962596e-02, -1.62144937e-02, -3.35488394e-02, -3.56017165e-02,  3.15230042e-02, -3.29707898e-02,  4.91029071e-03, -7.38063529e-02,  3.01549081e-02, -3.62814381e-03, -1.27273556e-02,  4.31789979e-02,  6.72039241e-02, -1.01358201e-02, -1.21333394e-02,  3.04502975e-02, -1.55297173e-02, -8.05976056e-03,  1.14756059e-02,  3.44254114e-02,  1.62869487e-02,  1.34580713e-02,  1.52852926e-02, -2.44130064e-02, -5.63092045e-02, -1.19329337e-02,  1.03381574e-02,  4.43323096e-03, -5.39388135e-02,  1.61344954e-03, -2.47488692e-02, -9.69927944e-03,  3.37590522e-04,  6.68173982e-03,  2.85064846e-01, -7.68646672e-02,  2.04954389e-02,  3.06511894e-02,  3.59828323e-02, -3.88769135e-02, -1.53356092e-02, -1.92584668e-03, -1.36766629e-02, -1.21121458e-03,  1.58430152e-02, -3.53457429e-03,  8.09049048e-03,  2.45662685e-02,  1.08423010e-01,  4.41827055e-04, -5.96931623e-03,  5.66804549e-03, -1.07940752e-02, -1.34310294e-02, -1.13090044e-02, -5.78078814e-03, -1.87163688e-02, -7.88134709e-03,  2.54769083e-02,  8.82385299e-02, -4.14695181e-02, -7.95725361e-03,  8.21708608e-03,  6.63400488e-03,  8.44927598e-03,  1.64056029e-02, -2.47094454e-03,  5.43627888e-03, -5.05806915e-02, -2.96825934e-02, -6.22137524e-02,  2.27656495e-02,  1.94431338e-02,  3.94692831e-03, -2.12241132e-02, -1.08067505e-02,  3.55228707e-02,  6.11234177e-03,  6.60064369e-02, -3.00559904e-02,  4.46795635e-02, -3.62207741e-02, -7.82330055e-03,  1.96162015e-02,  1.08669130e-02, -7.32199615e-03, -6.36008307e-02,  1.15890494e-02, -3.28908451e-02,  9.95039567e-03, -8.70451927e-02,  6.75665773e-03,  9.71929729e-03, -3.37874368e-02,  1.14139075e-04,  4.29460453e-03,  6.21224046e-02,  1.76265705e-02,  2.30988231e-03, -4.25247177e-02,  3.63673866e-02,  8.49564909e-04, -2.25463752e-02,  4.83208746e-02, -1.84661131e-02,  7.65062645e-02,  2.72060223e-02,  5.14252782e-02,  1.49026001e-02,  6.16921596e-02,  1.03613967e-03, -1.20458798e-02,  1.02116272e-03,  7.60705024e-02,  1.68521833e-02, -1.86913610e-02,  2.48749065e-03, -2.01884587e-03,  5.29181212e-02, -1.82129536e-02, -2.10545119e-02, -2.18267627e-02,  5.01855509e-03,  4.08760794e-02,  9.97032039e-04, -3.58510055e-02, -3.41250375e-02, -7.68247172e-02, -2.27306125e-04, -4.31966260e-02,  1.52278431e-02, -3.28047317e-04, -1.23898732e-02, -7.06377625e-03, -5.49805313e-02, -1.48873299e-03, -1.16005996e-02,  1.49461720e-03, -5.06405309e-02, -3.02351918e-02, -2.98370216e-02,  1.92503762e-02,  2.19157655e-02, -2.07558107e-02,  2.07510609e-02,  1.99893080e-02,  2.31435825e-03, -2.04255600e-02,  1.66209508e-02, -6.98144920e-03, -4.41346951e-02, -3.28787440e-03, -1.06157713e-01, -1.83860101e-02,  1.81749724e-02, -8.44282210e-02,  7.39252344e-02, -1.45862103e-02,  1.22052887e-02, -3.71664204e-02, -2.13775709e-02, -4.15905043e-02,  3.09480336e-02, -1.19161643e-02,  2.95598060e-03,  3.57839139e-03, -1.90851223e-02,  1.33911474e-02, -2.00638901e-02, -2.96307225e-02, -2.41420604e-02,  1.70334987e-02, -1.38404150e-03,  5.63359074e-02,  1.13857025e-02,  1.09565351e-02,  4.06453535e-02,  4.97192629e-02, -1.85689405e-02, -3.23042236e-02, -4.55507962e-03,  9.59399901e-03, -2.98230276e-02,  5.17474301e-02,  4.02742773e-02, -2.01121271e-02, -2.47660801e-02, -1.70557871e-02, -4.07381877e-02,  4.16745897e-03,  1.07471794e-02, -2.14407146e-02, -2.18170211e-02, -1.60198472e-02, -1.39396321e-02,  1.72422244e-03,  6.46969974e-02, -3.29226740e-02, -5.29860929e-02,  3.30749229e-02, -2.19977815e-02,  1.39707644e-02, -3.36653627e-02, -1.89832505e-02, -1.74050033e-02,  8.67677759e-03, -1.47987064e-02, -2.08439939e-02, -1.24445194e-02,  4.99234423e-02, -2.80609215e-03, -1.71437226e-02,  5.61795896e-03,  3.48413773e-02, -5.00266515e-02,  3.21132503e-02, -5.78017868e-02, -5.20432321e-03, -7.47705484e-03, -5.77214807e-02,  1.76084395e-02, -2.46514529e-02,  1.40149379e-04, -1.35102440e-02,  2.74757221e-02,  3.98653885e-03, -3.03052869e-02,  5.38571179e-03, -4.49086213e-03,  2.57188827e-03, -1.01259807e-02, -5.60614862e-04, -2.24291347e-02,  1.17443483e-02,  3.43906664e-04, -1.36940731e-02,  1.62192825e-02, -2.63981763e-02, -5.09480853e-03, -2.96740253e-02,  3.72137949e-02, -4.19342238e-03,  4.44629453e-02, -1.81854814e-02,  3.19880061e-02, -3.29014435e-02, -7.07932636e-02,  8.06505050e-05, -6.50598481e-02, -2.65149809e-02,  2.35201325e-03, -1.84763521e-02,  1.85038038e-02, -8.24570656e-03,  3.76500860e-02, -1.87196548e-03,  1.89240696e-03, -1.63772777e-02, -2.58923583e-02, -6.99638715e-03,  8.84607285e-02,  4.42139767e-02,  5.44911958e-02,  3.44089791e-02,  3.11395470e-02,  4.30394262e-02, -5.71211651e-02, -8.60228087e-04, -3.56615148e-02, -4.29532938e-02, -3.96795049e-02, -6.96531832e-02, -6.99146837e-03, -1.54025080e-02,  3.24060558e-03,  1.90217085e-02, -6.32854761e-04, -4.23147604e-02,  3.78877185e-02, -7.15087727e-02,  2.14720354e-03, -7.56523991e-03,  1.77785512e-02,  4.15690290e-03,  1.31920716e-02, -4.47469912e-02,  2.02927878e-03, -9.70351230e-03, -2.44885148e-03,  9.17060860e-03, -7.06019923e-02,  3.90433311e-03, -4.82924050e-03, -3.57484855e-02, -3.95380370e-02, -2.66085350e-04, -9.09091979e-02, -2.31957599e-03,  8.17876495e-03,  4.47255895e-02, -4.31056283e-02,  1.09299524e-02,  2.22252961e-02, -9.69189312e-03, -4.62152716e-03, -1.23557402e-02,  4.31880914e-02, -2.05426998e-02, -1.18838316e-02, -4.70328778e-02,  1.83505062e-02, -4.79386337e-02, -2.73010582e-02,  2.51525976e-02, -1.75959654e-02, -3.39280046e-03, -9.90216807e-03, -1.59658920e-02, -1.11917658e-02,  2.39243973e-02,  2.35856287e-02, -1.24922618e-02, -1.36338519e-02, -5.58076277e-02, -2.19142232e-02, -4.71323058e-02,  6.01367047e-03,  6.15458423e-03, -1.31465374e-02, -4.37477678e-02, -2.79929917e-02,  4.23972830e-02, -2.80982573e-02,  2.16858871e-02, -2.45451722e-02, -1.00991065e-02, -2.03979593e-02,  7.44338613e-03,  1.43099865e-02,  1.86065994e-02, -2.22229771e-03, -3.45460698e-03, -4.02015746e-02,  3.98092391e-03,  5.06204972e-03, -6.71794116e-02,  5.69087677e-02, -1.45429140e-02,  4.57357569e-03, -1.34921176e-02, -3.71276438e-02, -3.58194718e-03, -8.24898668e-03, -7.89433718e-03,  1.91919059e-02,  2.89815222e-03, -3.50510143e-02,  6.06723654e-04,  1.97406951e-02,  1.09042050e-02,  5.46610095e-02, -9.46197566e-03, -2.57765930e-02, -3.52716483e-02, -3.13208275e-03, -6.36805668e-02,  3.14744562e-02, -1.36128832e-02, -4.01474256e-03,  2.76806410e-02,  1.18856179e-02, -3.10220141e-02,  9.46694054e-03, -1.01415701e-02,  3.05054504e-02,  3.29197152e-03, -1.43702095e-02,  2.22052149e-02, -1.73337311e-02,  9.35158040e-03,  1.02317994e-02,  2.30447073e-02, -1.37977013e-02,  3.35895009e-02, -4.35892530e-02,  6.48276601e-03,  6.70667961e-02,  1.11273043e-02,  3.62930708e-02, -1.31617850e-02, -1.85873471e-02,  1.36977504e-03, -1.02755073e-02,  7.01492419e-03,  3.67209353e-02,  5.81660792e-02,  3.50584202e-02, -4.21873853e-03,  2.07033977e-02, -8.08366947e-03,  2.41213432e-03,  1.30304340e-02,  4.15483415e-02, -1.14974111e-01,  1.58723611e-02, -4.28978503e-02, -2.10810993e-02, -1.14929285e-02, -3.64279710e-02,  4.43884656e-02,  6.11147396e-02, -3.19659919e-03,  4.74641547e-02, -2.24046828e-03,  3.10992613e-03, -1.79260857e-02,  2.74331979e-02, -2.54569203e-02, -5.36161736e-02, -2.20865104e-02, -4.86022383e-02,  3.07407305e-02,  7.87600037e-03, -7.28830323e-03, -9.65946540e-03, -3.32631767e-02, -2.64088232e-02, -2.50527393e-02,  3.62710766e-02,  2.78802458e-02, -7.86242858e-02,  1.80662405e-02,  1.51304360e-02,  1.56321470e-02,  1.13500310e-02,  1.29078537e-01, -4.42109443e-02, -6.94898609e-03, -5.17682871e-03, -1.82883237e-02, -1.55876542e-03,  1.25772599e-03,  3.99484020e-03,  3.13190110e-02, -7.99560733e-03, -9.29906312e-03, -9.61368904e-03, -9.68278572e-03,  2.19231661e-04,  1.50288129e-02,  1.24180438e-02, -3.50592807e-02, -1.81015134e-02,  3.62327620e-02,  3.43864933e-02, -2.99504027e-03,  2.10388610e-03,  2.72047948e-02,  1.61710177e-02,  6.74367463e-03,  3.53129022e-02, -3.63118649e-02, -2.27873307e-03, -2.63242777e-02,  1.98343936e-02, -3.12150344e-02, -7.84517732e-04, -6.41357526e-02,  5.54801114e-02, -7.29019418e-02, -4.18803468e-02,  1.45922294e-02, -2.82196118e-03, -3.17592807e-02,  3.90798086e-03, -2.77240742e-02, -4.13016379e-02,  1.09245442e-02, -2.96040922e-02,  1.41646655e-03, -7.70183420e-03, -2.73235012e-02,  2.45321486e-02, -1.68266036e-02, -1.48535129e-02,  1.27136754e-02, -3.14491615e-02,  2.01341249e-02, -1.90103855e-02,  4.16883221e-03, -1.25765745e-02, -4.77019586e-02, -1.27441837e-02, -2.89561003e-02,  3.93704139e-02,  3.27107385e-02, -8.34575817e-02,  3.52550894e-02,  3.61613790e-03,  1.66957639e-02,  4.16566432e-02,  5.50485738e-02,  4.45440486e-02,  1.61871463e-02,  6.63557798e-02, -2.19960976e-02, -9.82081424e-03,  3.15692858e-03]": "滴滴滴滴滴"}')

    AI名字 = models.TextField(default='BOT')

    温度 = models.TextField(default='0.9')

    最大输出字数 = models.TextField(default='2048')

    检索记忆长度 =models.TextField(default='5000')

    相似度阈值 = models.TextField(default='0.5')

    相似度最高的键的数量 = models.TextField(default='5')


class ChatRecord(models.Model):

    # 聊天模型ID，关联某个AI的ID
    ai_model = models.ForeignKey(AIModel, on_delete=models.CASCADE)
    # 聊天时间
    chat_time = models.DateTimeField(auto_now_add=True)
    # 聊天内容
    chat_content = models.TextField()
    # 模式（0/1）
    mode = models.CharField(max_length=1, choices=[("0", "0"), ("1", "1")])